<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Generator WhatsApp Undangan</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    body {
      background: #f5f7fb;
    }

    .card-custom {
      border-radius: 18px;
      padding: 25px;
      background: #fff;
      box-shadow: 0 6px 16px rgba(0,0,0,0.06);
    }

    .section-title {
      font-weight: 700;
      font-size: 1.4rem;
    }

    .list-item-card {
      border-radius: 12px !important;
      padding: 14px 18px !important;
      background: #ffffff;
      border: 1px solid #e8e8e8;
    }

    .wa-button {
      border-radius: 10px;
      font-size: 0.9rem;
      padding: 8px 14px;
    }

    @media (max-width: 575px) {
      .section-title {
        font-size: 1.2rem;
      }
    }
  </style>
</head>

<body>

<div class="container py-4">

  <!-- Judul -->
  <div class="text-center mb-4">
    <h2 class="fw-bold">ğŸ“© Generator WhatsApp Undangan</h2>
    <p class="text-muted">Upload Excel â†’ Otomatis buat link WA undangan</p>
  </div>

  <!-- Card Utama -->
  <div class="card-custom mb-4">

    <h5 class="section-title mb-3">ğŸ“ Upload File Excel</h5>

    <div class="mb-3">
      <label class="form-label">Pilih File (.xlsx)</label>
      <input type="file" id="fileInput" accept=".xlsx" class="form-control">
    </div>

    <hr>

    <h5 class="section-title mb-3">ğŸ”— Pengaturan Undangan</h5>

    <div class="mb-3">
      <label class="form-label">URL Undangan</label>
      <input type="text" id="baseURL" class="form-control"
             value="https://undanganmikhael.com/">
    </div>

    <div class="mb-3">
      <label class="form-label">Template Pesan WhatsApp</label>
      <textarea id="messageTemplate" rows="5" class="form-control">
Halo {prefix} {nama}, kami mengundang Anda ke acara pernikahan kami.
Silakan buka link undangan berikut: {link}
Terima kasih atas perhatian dan doa restunya ğŸŒ¸
      </textarea>
    </div>

    <button id="generateBtn" class="btn btn-primary w-100 py-2 mt-2" disabled>
      ğŸš€ Generate WhatsApp Links
    </button>

  </div>

  <!-- Hasil -->
  <div class="card-custom">
    <h5 class="section-title mb-3">ğŸ“œ Hasil Generate</h5>
    <ul id="result" class="list-group"></ul>
  </div>

</div>


<script>
let tamu = [];

// Normalisasi Nomor WA
function normalizeNumber(num) {
  if (!num) return "";
  return num.toString()
    .replace(/\s+/g, "")
    .replace(/\+/g, "")
    .replace(/-/g, "")
    .replace(/\(/g, "")
    .replace(/\)/g, "");
}

// Upload dan Baca Excel
document.getElementById("fileInput").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, { type: 'array' });
    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
    tamu = XLSX.utils.sheet_to_json(firstSheet);

    tamu = tamu.map(t => ({
      ...t,
      wa: normalizeNumber(t.wa)
    }));

    if (tamu.length > 0) {
      alert(`Berhasil memuat ${tamu.length} data tamu dari Excel âœ…`);
      document.getElementById("generateBtn").disabled = false;
    } else {
      alert("File kosong atau format kolom salah!");
    }
  };

  reader.readAsArrayBuffer(file);
});

// Generate WhatsApp Links
document.getElementById("generateBtn").addEventListener("click", () => {
  const baseURL = document.getElementById("baseURL").value.trim();
  const template = document.getElementById("messageTemplate").value.trim();
  const resultList = document.getElementById("result");

  resultList.innerHTML = "";

  tamu.forEach(t => {
    if (!t.prefix || !t.nama || !t.wa) return;

    const link = `${baseURL}?p=${encodeURIComponent(t.prefix)}&n=${encodeURIComponent(t.nama)}`;

    const message = template
      .replace("{prefix}", t.prefix)
      .replace("{nama}", t.nama)
      .replace("{link}", link);

    const waLink = `https://api.whatsapp.com/send?phone=${t.wa}&text=${encodeURIComponent(message)}`;

    const li = document.createElement("li");
    li.className = "list-group-item list-item-card d-flex justify-content-between align-items-center";

    li.innerHTML = `
      <div>
        <strong>${t.prefix} ${t.nama}</strong><br>
        <small class="text-muted">${link}</small>
      </div>
      <a href="${waLink}" target="_blank" class="btn btn-success btn-sm wa-button">ğŸ“© Kirim</a>
    `;

    resultList.appendChild(li);
  });
});
</script>

</body>

</html>
