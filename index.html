<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generator WhatsApp Undangan dari Excel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="p-5 bg-light">

  <div class="container">
    <h2 class="mb-3">ðŸ“© Generator WhatsApp Undangan Otomatis dari Excel</h2>
    <p>Upload file Excel berisi daftar tamu (prefix, nama, wa).</p>

    <div class="mb-3">
      <label for="fileInput" class="form-label">Upload File Excel (.xlsx)</label>
      <input type="file" id="fileInput" accept=".xlsx" class="form-control">
    </div>

    <div class="mb-3">
      <label for="baseURL" class="form-label">URL Undangan</label>
      <input type="text" id="baseURL" class="form-control" value="https://undanganmikhael.com/">
    </div>

    <div class="mb-3">
      <label for="messageTemplate" class="form-label">Template Pesan WhatsApp</label>
      <textarea id="messageTemplate" class="form-control" rows="5">Halo {prefix} {nama}, kami mengundang Anda ke acara pernikahan kami.
Silakan buka link undangan berikut: {link}
Terima kasih atas perhatian dan doa restunya ðŸŒ¸</textarea>
    </div>

    <button id="generateBtn" class="btn btn-primary mb-4" disabled>Generate WhatsApp Links</button>

    <ul id="result" class="list-group"></ul>
  </div>

  <script>
    let tamu = [];

    // Baca file Excel saat diupload
    document.getElementById("fileInput").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        tamu = XLSX.utils.sheet_to_json(firstSheet);

        if (tamu.length > 0) {
          alert(`Berhasil memuat ${tamu.length} data tamu dari Excel âœ…`);
          document.getElementById("generateBtn").disabled = false;
        } else {
          alert("File kosong atau tidak memiliki kolom prefix, nama, wa!");
        }
      };
      reader.readAsArrayBuffer(file);
    });

    document.getElementById("generateBtn").addEventListener("click", () => {
      const baseURL = document.getElementById("baseURL").value.trim();
      const messageTemplate = document.getElementById("messageTemplate").value.trim();
      const resultList = document.getElementById("result");
      resultList.innerHTML = "";

      tamu.forEach(t => {
        if (!t.prefix || !t.nama || !t.wa) return; // pastikan lengkap

        // Buat link undangan unik
        const link = `${baseURL}?p=${encodeURIComponent(t.prefix)}&n=${encodeURIComponent(t.nama)}`;

        // Ganti placeholder di template
        const message = messageTemplate
          .replace("{prefix}", t.prefix)
          .replace("{nama}", t.nama)
          .replace("{link}", link);

        // Encode untuk WhatsApp
        const encodedMessage = encodeURIComponent(message);
        const waLink = `https://api.whatsapp.com/send?phone=${t.wa}&text=${encodedMessage}`;


        // Tambahkan ke list
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between align-items-center";
        li.innerHTML = `
          <div>
            <strong>${t.prefix} ${t.nama}</strong><br>
            <small>${link}</small>
          </div>
          <a href="${waLink}" target="_blank" class="btn btn-success btn-sm">ðŸ“© Kirim WA</a>
        `;
        resultList.appendChild(li);
      });
    });
  </script>

</body>
</html>
